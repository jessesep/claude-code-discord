# Util Compartment Context
> **Scope**: Cross-platform bridge and shared logic.

## üéØ Mission
Provide a standard library for OS-specific operations, persistence, and network utilities. Ensures the bot runs consistently on macOS, Linux, and Windows.

## üó∫Ô∏è Key Filepaths
- `platform.ts`: OS detection and mapping of system-specific CLI commands (ps, uptime, etc.).
- `settings-persistence.ts`: JSON-based state storage for bot configuration and runtime flags.
- `proxy.ts`: Deno-based proxy server logic for internal routing/tunneling.

## üõ†Ô∏è Key Dependencies
- `Deno` Globals: `Deno.build.os`, `Deno.stat`, `Deno.readTextFile`.
- `npm:jsonfile`: (Potentially) for managed JSON persistence.

## üìú Conventions
- **OS Agnostic**: Always use `getPathSeparator()` or `normalizePath()` instead of hardcoded `/` or `\`.
- **Command Selection**: Use `getPlatformCommands()` when spawning system processes to ensure compatibility.
- **Fail-Safe**: Persistence logic should use atomic writes (temp file + rename) where possible.

## üí° Code Example: Platform Logic
```typescript
export function getPlatformCommands(): SystemCommands {
  const platform = detectPlatform(); // 'windows' | 'linux' | 'darwin'
  switch (platform) {
    case 'windows': return { processListCmd: ['powershell', 'Get-Process'], ... };
    case 'linux':   return { processListCmd: ['ps', 'aux'], ... };
    case 'darwin':  return { processListCmd: ['ps', 'aux'], ... };
    default:        return FALLBACK_CMDS;
  }
}
```
