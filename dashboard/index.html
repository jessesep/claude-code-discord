<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antigravity Agent Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #09090b;
            color: #fafafa;
        }
        .mono {
            font-family: 'JetBrains Mono', monospace;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #09090b;
        }
        ::-webkit-scrollbar-thumb {
            background: #27272a;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #3f3f46;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="module">
        // Use esm.sh to load and transpile TypeScript files
        import React from 'https://esm.sh/react@^19.2.3';
        import { createRoot } from 'https://esm.sh/react-dom@^19.2.3/client';
        
        // Import App component - esm.sh can handle TypeScript with ?tsx parameter
        // But we need to serve it through a proxy or use a different approach
        // Let's create a simple inline version first to test
        
        // For now, create a minimal working dashboard
        const { useState, useEffect } = React;
        
        function App() {
            const [activeTab, setActiveTab] = React.useState('dash');
            const [agents, setAgents] = React.useState([]);
            const [sessions, setSessions] = React.useState([]);
            const [settings, setSettings] = React.useState({});
            const [loading, setLoading] = React.useState(true);
            
            React.useEffect(() => {
                async function loadData() {
                    try {
                        const [agentsRes, sessionsRes, settingsRes] = await Promise.all([
                            fetch('/api/agents'),
                            fetch('/api/sessions'),
                            fetch('/api/settings')
                        ]);
                        
                        const agentsData = await agentsRes.json();
                        const sessionsData = await sessionsRes.json();
                        const settingsData = await settingsRes.json();
                        
                        setAgents(agentsData.agents || []);
                        setSessions(sessionsData.sessions || []);
                        setSettings(settingsData);
                        setLoading(false);
                    } catch (error) {
                        console.error('Failed to load data:', error);
                        setLoading(false);
                    }
                }
                loadData();
                const interval = setInterval(loadData, 10000);
                return () => clearInterval(interval);
            }, []);
            
            if (loading) {
                return React.createElement('div', { className: 'flex items-center justify-center h-screen' },
                    React.createElement('div', { className: 'text-zinc-500' }, 'Loading dashboard...')
                );
            }
            
            const activeSessions = sessions.filter(s => s.status === 'active').length;
            const totalCost = sessions.reduce((acc, s) => acc + (s.totalCost || 0), 0).toFixed(3);
            
            return React.createElement('div', { className: 'flex h-screen bg-[#09090b]' },
                // Sidebar
                React.createElement('aside', { className: 'w-64 border-r border-zinc-800 bg-zinc-950 p-8' },
                    React.createElement('div', { className: 'flex items-center gap-3 mb-8' },
                        React.createElement('div', { className: 'w-8 h-8 bg-indigo-600 rounded flex items-center justify-center font-bold text-white' }, 'A'),
                        React.createElement('span', { className: 'font-bold text-lg' }, 'ANTIGRAVITY')
                    ),
                    React.createElement('nav', { className: 'space-y-2' },
                        ['dash', 'agents', 'webhooks', 'settings'].map(tab =>
                            React.createElement('button', {
                                key: tab,
                                onClick: () => setActiveTab(tab),
                                className: `w-full text-left px-4 py-3 rounded-lg ${activeTab === tab ? 'bg-zinc-900 text-white' : 'text-zinc-500 hover:text-zinc-200'}`,
                            }, tab.charAt(0).toUpperCase() + tab.slice(1))
                        )
                    )
                ),
                // Main content
                React.createElement('main', { className: 'flex-1 p-8 overflow-y-auto' },
                    activeTab === 'dash' && React.createElement('div', { className: 'space-y-8' },
                        React.createElement('h1', { className: 'text-3xl font-bold' }, 'Dashboard'),
                        React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' },
                            React.createElement('div', { className: 'bg-zinc-900 border border-zinc-800 p-6 rounded-2xl' },
                                React.createElement('p', { className: 'text-zinc-500 text-xs uppercase' }, 'Active Agents'),
                                React.createElement('h3', { className: 'text-3xl font-bold' }, activeSessions)
                            ),
                            React.createElement('div', { className: 'bg-zinc-900 border border-zinc-800 p-6 rounded-2xl' },
                                React.createElement('p', { className: 'text-zinc-500 text-xs uppercase' }, 'Total Cost'),
                                React.createElement('h3', { className: 'text-3xl font-bold' }, `$${totalCost}`)
                            ),
                            React.createElement('div', { className: 'bg-zinc-900 border border-zinc-800 p-6 rounded-2xl' },
                                React.createElement('p', { className: 'text-zinc-500 text-xs uppercase' }, 'Port'),
                                React.createElement('h3', { className: 'text-3xl font-bold' }, '3000')
                            )
                        ),
                        sessions.length > 0 && React.createElement('div', { className: 'bg-zinc-900 border border-zinc-800 rounded-2xl p-6' },
                            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'Active Sessions'),
                            React.createElement('div', { className: 'space-y-2' },
                                sessions.map(session =>
                                    React.createElement('div', { key: session.id, className: 'p-4 bg-zinc-950 rounded border border-zinc-800' },
                                        React.createElement('div', { className: 'flex justify-between' },
                                            React.createElement('span', { className: 'font-bold' }, session.agentName),
                                            React.createElement('span', { className: 'text-zinc-500 text-sm' }, `$${session.totalCost.toFixed(3)}`)
                                        ),
                                        React.createElement('p', { className: 'text-sm text-zinc-400' }, `Messages: ${session.messageCount}`)
                                    )
                                )
                            )
                        )
                    ),
                    activeTab === 'agents' && React.createElement('div', { className: 'space-y-8' },
                        React.createElement('h1', { className: 'text-3xl font-bold' }, 'Agents'),
                        React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                            agents.map(agent =>
                                React.createElement('div', { key: agent.id, className: 'bg-zinc-900 border border-zinc-800 p-6 rounded-2xl' },
                                    React.createElement('h3', { className: 'font-bold text-lg mb-2' }, agent.name),
                                    React.createElement('p', { className: 'text-sm text-zinc-400 mb-4' }, agent.description),
                                    React.createElement('div', { className: 'flex gap-2 flex-wrap' },
                                        agent.capabilities.map((cap, i) =>
                                            React.createElement('span', { key: i, className: 'px-2 py-1 bg-zinc-800 rounded text-xs' }, cap)
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    activeTab === 'webhooks' && React.createElement('div', { className: 'space-y-8' },
                        React.createElement('h1', { className: 'text-3xl font-bold' }, 'Webhooks'),
                        settings.webhooks && settings.webhooks.length > 0 ? (
                            React.createElement('div', { className: 'space-y-4' },
                                settings.webhooks.map(wh =>
                                    React.createElement('div', { key: wh.id, className: 'bg-zinc-900 border border-zinc-800 p-6 rounded-2xl' },
                                        React.createElement('div', { className: 'flex justify-between items-center' },
                                            React.createElement('span', { className: 'font-bold' }, wh.name),
                                            React.createElement('span', { className: `text-xs px-2 py-1 rounded ${wh.enabled ? 'bg-green-500/10 text-green-500' : 'bg-zinc-800 text-zinc-500'}` },
                                                wh.enabled ? 'Active' : 'Inactive'
                                            )
                                        )
                                    )
                                )
                            )
                        ) : React.createElement('p', { className: 'text-zinc-500' }, 'No webhooks configured')
                    ),
                    activeTab === 'settings' && React.createElement('div', { className: 'space-y-8' },
                        React.createElement('h1', { className: 'text-3xl font-bold' }, 'Settings'),
                        React.createElement('div', { className: 'bg-zinc-900 border border-zinc-800 p-6 rounded-2xl' },
                            React.createElement('div', { className: 'space-y-4' },
                                React.createElement('div', null,
                                    React.createElement('label', { className: 'block text-sm font-bold mb-2' }, 'Default Model'),
                                    React.createElement('input', {
                                        type: 'text',
                                        value: settings.defaultModel || '',
                                        onChange: (e) => setSettings({...settings, defaultModel: e.target.value}),
                                        className: 'w-full bg-zinc-950 border border-zinc-800 rounded px-4 py-2'
                                    })
                                ),
                                React.createElement('button', {
                                    onClick: async () => {
                                        try {
                                            await fetch('/api/settings', {
                                                method: 'POST',
                                                headers: {'Content-Type': 'application/json'},
                                                body: JSON.stringify(settings)
                                            });
                                            alert('Settings saved!');
                                        } catch (error) {
                                            alert('Failed to save settings');
                                        }
                                    },
                                    className: 'px-4 py-2 bg-indigo-600 hover:bg-indigo-500 rounded text-white font-bold'
                                }, 'Save Settings')
                            )
                        )
                    )
                )
            );
        }
        
        const rootElement = document.getElementById('root');
        if (rootElement) {
            const root = createRoot(rootElement);
            root.render(React.createElement(React.StrictMode, null, React.createElement(App)));
        }
    </script>
</body>
</html>
