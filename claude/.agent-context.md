# Claude (Engine) Compartment Context
> **Scope**: AI Engine abstraction. Unified broker for LLM interactions.

## ğŸ¯ Mission
Abstract LLM providers (Gemini, Antigravity, Cursor) into a consistent interface. Handles session-based history integration, response streaming, and output redirection to Discord components.

## ğŸ—ºï¸ Key Filepaths
- `antigravity-client.ts`: Main SDK-based Gemini 2.0 implementation with multi-auth (Key/ADC).
- `cursor-client.ts`: CLI-based bridge for "Cursor-Fast" and "Claude-Code" local tools.
- `enhanced-client.ts`: Logic for model templates (React, Python, etc.) and history management.
- `discord-sender.ts`: Bridges client streaming chunks into Discord message updates.

## ğŸ› ï¸ Key Dependencies
- `npm:@google/generative-ai`: Core SDK for direct Gemini logic.
- `Deno.Command`: For spawning local CLI-based agents.

## ğŸ“œ Conventions
- **Client Factory**: Use clients that support `AbortController` for request cancellation.
- **SSE Parsing**: CLI-based clients must handle line-buffered stream parsing for real-time Discord updates.
- **Model Preference**: Use `gemini-2.0-flash-thinking-exp` for complex tasks; standard `flash` for orchestration.

## ğŸ’¡ Code Example: Multi-Auth Gemini
```typescript
export async function sendToAntigravityCLI(prompt: string, ctrl: AbortController, opts: any) {
  // Strategy 1: SDK with API Key
  if (API_KEY) {
    const genAI = new GoogleGenerativeAI(API_KEY);
    return await genAI.getGenerativeModel({ model: opts.model }).generateContent(prompt);
  }
  // Strategy 2: REST with gcloud OAuth Token
  const token = await getGcloudToken();
  if (token) return await fetch(REST_URL, { headers: { Authorization: `Bearer ${token}` }, body: ... });
}
```
