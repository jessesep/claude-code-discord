# Claude-Discord Agent-Context

> **MANDATORY READ**: Agents MUST read this file (and any `.agent-context.md` in subdirectories) before interacting with the codebase. This is a compressed source of truth to minimize context token usage while maximizing performance.

## üéØ Project Mission

A highly modular, hierarchical agent system that bridges Discord with a powerful "Manager-Subagent" framework (Antigravity). It uses `gemini-3-flash-preview` for orchestration and specialized subagents for execution.

## üèóÔ∏è Compartment Map (Core Tree)

- `/agent/`: **The Brain**. Contains the Manager logic, Session management, and the "Kernel" for subagent spawning.
- `/discord/`: **The Interface**. Discord bot commands, event handlers, and UI (embeds/components).
- `/claude/`: **The Engine**. API clients (even though it's called claude, it uses Gemini) and model interaction logic.
- `/git/`: **The Hand**. Git operations, repository state management.
- `/server/` & `/dashboard/`: **The View**. Hono server and frontend UI for bot monitoring/config.
- `/settings/`: **The Memory**. Persistent configuration and state.

## üöÄ Supported Models

When using the Discord slash command `/agent action:chat` or observing agent behavior, the following models are supported:

- **Primary/Default**: `gemini-3-flash-preview` (Latest, high-speed, "Pro-reasoning" at Flash price).
- **Stable Tier**: `gemini-2.0-flash`, `gemini-1.5-flash`.
- **Reasoning Tier**: `gemini-2.0-flash-thinking-exp` (Thinking mode), `gemini-exp-1206`.
- **Pro Tier**: `gemini-2.0-pro-exp`, `gemini-1.5-pro` (Large context, complex logic).
- **Cursor Models**: `claude-3-5-sonnet`, `claude-3-opus`, `gpt-4o`, `o1`, `gemini-1.5-pro`, and more.

**MANDATORY**: `gemini-3-flash-preview` is the default model for all new sessions and orchestrations. Agents should recommend this model for most tasks due to its superior speed/reasoning balance. Use the `model` option in `/agent` to override the default model.

## üìú Global Conventions

- **Language**: TypeScript (Deno runtime).
- **Style**: Functional where possible, but use Classes for State (e.g., `AgentSession`).
- **File Naming**: `kebab-case` for general files, `PascalCase` for classes.
- **Agent Communication**: Use structured JSON for inter-agent delegation.
- **Dynamic Spawning**: The `AgentRegistry` allows registering specialized subagents at runtime.

## ‚öñÔ∏è Rules of Engagement

1. **Context Hierarchy**: Always check the local `.agent-context.md` when entering a new directory.
2. **Minimalism**: Write concise, high-impact code. Avoid bloat.
3. **Safety**: Never execute destructive commands without verifying the `Cwd` and intent.

## üîå Provider Architecture

The system supports multiple AI providers through a unified `AgentProvider` interface:

| Provider | ID | Auth Method | Models Source |
|----------|-----|-------------|---------------|
| Gemini API | `gemini-api` | `GEMINI_API_KEY` | `util/list-models.ts` |
| Antigravity | `antigravity` | gcloud OAuth | Same as Gemini |
| Cursor | `cursor` | Cursor CLI | `cursor-provider.ts` |
| Claude CLI | `claude-cli` | Anthropic CLI | `claude-cli-provider.ts` |
| Ollama | `ollama` | Local server | Dynamic from API |

### ‚ö†Ô∏è Provider-Related Development Rules

When modifying `/run`, `/run-adv`, or provider-related code:

1. **Provider-specific logic must stay provider-specific** - Don't hardcode one provider's models for all providers
2. **Update all enumeration points** when adding providers:
   - `agent/handlers.ts` (providerOptions)
   - `discord/event-handlers.ts` (model selection)
   - `agent/providers/index.ts` (registration)
3. **Use `AgentProviderRegistry.getProvider()`** to access provider data
4. **Test each provider path** end-to-end after changes

## üõ†Ô∏è Tooling

- `deno run -A ...`: Standard execution.
- `agy`: Antigravity CLI (internal use).
- **Bot Manager MCP**: High-level bot orchestration via stdio server (`util/mcp-server.ts`).

## üöÄ Efficient Git Workflow

For the most efficient path to committing and pushing changes:

1. **MCP (Recommended for Agents)**: Use the `GitKraken` MCP server tools (`git_add_or_commit`, `git_push`). This is the fastest way for an agent to capture work without leaving the flow.
2. **VS Code Extension**: Use the **GitKraken** or **GitLens** extensions for visual staging and diff inspection.
3. **Atomic Commits**: Commit one logical change at a time (e.g., "fix: model name", "feat: orchestration retry").
4. **Summary Documentation**: When completing a major task, generate a `FIX-SUMMARY.md` or update the `walkthrough.md` _before_ pushing, so the history is self-documenting.
