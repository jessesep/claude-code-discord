# one agent discord - Agent Context

## ğŸ¯ Mission
A sophisticated Discord-based AI coding assistant orchestrating specialized subagents. Unified broker for multi-agent workflows, Git operations, and system management. This project is branded as **one agent discord** (lowercase, no hyphens in display name).

## ğŸ“‚ Compartments
To maintain architectural focus, use the compartment-level context files:
- [**Agent**](file:///Users/jessesep/repos/claude-code-discord/agent/.agent-context.md): Orchestration, registry, and subagent management.
- [**Discord**](file:///Users/jessesep/repos/claude-code-discord/discord/.agent-context.md): Bot interface, commands, and interaction UI.
- [**Provider Clients**](file:///Users/jessesep/repos/claude-code-discord/provider-clients/.agent-context.md): LLM provider abstraction and streaming.
- [**Utility**](file:///Users/jessesep/repos/claude-code-discord/util/.agent-context.md): Shared services, Git, GitHub, and Memory bridges.
- [**Tests**](file:///Users/jessesep/repos/claude-code-discord/tests/): E2E test suites and utilities.

## ğŸ† Golden Standards
1. **Branding First**: This project is **one agent discord** (lowercase). Use this name in all comments, headers, docs, and user-facing strings. Never use "Claude Code Discord Bot" or similar legacy names.
2. **Always read context first**: Your VERY FIRST action MUST be to use the `view_file` tool to read the root `.agent-context.md` and the context file of your working compartment.
3. **Agent Instance Isolation**: Every spawned agent MUST have:
   - A unique **Agent Instance ID**: `{agentType}-{channelPrefix}-{timestamp}-{random}`
   - **Hard channel binding**: Agents can ONLY respond in their bound channel (no crosstalk)
   - **Isolated context window**: Each instance maintains its own conversation history
   - See `agent/instance-registry.ts` for the canonical implementation
4. **Never Downgrade Models**: NEVER fall back to older/worse AI models without explicit user permission. If a model name is invalid, find the correct name for that generation - do NOT fall back to an older generation. See `util/list-models.ts` for model resolution.
5. **Manager-Subagent Flow**: The Manager assesses complexity and spawns specific agents (Coder, Architect, etc.) for heavy lifting.
6. **Interactive UX**: Prefer Discord embeds and buttons over raw text for a premium feel.
7. **Memory Dependency**: Use `claude-mem` tools (search/timeline) to maintain continuity across long-lived coding tasks.

## ğŸ†• Recently Added Capabilities

### Testing Mode (`util/testing-mode.ts`)
Enable with `TESTING_MODE=true` to bypass all restrictions:
- Auto-approve high-risk agents
- Disable sandbox restrictions
- Force mode enabled
- Bypass channel restrictions

### Speed Indicators (`agent/handlers.ts`)
Response embeds now show speed with emojis:
- âš¡ < 3 seconds (blazing fast)
- ğŸš€ < 10 seconds (fast)
- â³ > 10 seconds (slow)

### Model Resolution (`util/list-models.ts`)
Automatic model name resolution and caching:
- `resolveModelName()` - Resolves common naming discrepancies
- `resolveModelNameForClient()` - Client-specific mapping (Cursor vs Antigravity)
- `getCachedModels()` - Caches available models from API

### Agent Styling (`agent/types.ts`)
Each agent type has unique styling:
- `getAgentStyle(agentType)` - Returns emoji and color for agent
- Predefined: ğŸ¯ Manager, ğŸ’» Coder, ğŸ—ï¸ Architect, ğŸ›¡ï¸ Security, ğŸ§ª Tester, etc.

### E2E Testing (`tests/e2e-utils.ts`)
Robust testing utilities:
- `withTestContext()` - Auto-cleanup test contexts
- `spawnAgent()` - High-level agent spawning
- `TEST_CHANNELS` - Registry of test channel IDs
- Category isolation verified

## ğŸ§  Memory & Tools
This repo is heavily integrated with `claude-mem`.
- Use `search(query="...", project="claude-code-discord")` to find previous bugfixes or architectural decisions.
- Follow the patterns in `CLAUDE.md` for build/test commands.

## ğŸ›  Improvement Tasks
- [x] Refine "Golden Standards" for orchestration efficiency.
- [x] Create detailed `.agent-context.md` files for major functional directories.
- [x] Add speed indicators to Discord embeds
- [x] Implement agent instance isolation
- [x] Add testing mode infrastructure
- [ ] Add progress bar for long-running tasks (#143)
- [ ] Add agent selection dropdown menu (#144)
- [ ] Implement model fallback chain (#145)
- [ ] Add usage analytics dashboard (#146)
- [ ] Document the primary data models (Sessions, Swarms)
- [ ] Audit `CLAUDE.md` to ensure command parity with latest features
