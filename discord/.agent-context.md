# Discord Compartment Context
> **Scope**: Discord UI, command registration, and interaction orchestration.

## ğŸ¯ Mission
Provide the "Face" of the application. Responsible for handling Discord interactions (slash commands, buttons, menus), managing channel-specific state, and formatting AI responses into rich Discord embeds.

## ğŸ—ºï¸ Key Filepaths
- `discord/bot.ts`: The main entry point for the Discord bot login and event loop.
- `discord/commands.ts`: Definition and registration logic for all slash commands.
- `discord/interaction-context.ts`: Encapsulates context for a single interaction (channel, member, options).
- `discord/event-handlers.ts`: Logic for routing autocomplete, button clicks, and modal submissions.
- `discord/formatting.ts`: Utilities for transforming raw markdown/JSON into Discord-compatible embeds and messages.

## ğŸ› ï¸ Key Dependencies
- `discord.js`: The primary framework for Discord API interaction.
- `../agent/`: For delegating tasks from Discord commands to specialized agents.

## ğŸ“œ Conventions
- **Deferred Replies**: Always `deferReply({ ephemeral })` for commands that might take longer than 3 seconds.
- **Embeds First**: Use rich embeds for status updates and results to provide a premium UX.
- **Channel Isolation**: Use the `channelId` to maintain task separation; avoid cross-channel state leakage.

## ğŸ’¡ Code Example: Command Handling
```typescript
export async function handleClaudeCommand(interaction: CommandInteraction) {
  const ctx = new InteractionContext(interaction);
  await ctx.sendInitialEmbed("Thinking...");
  const agent = AgentRegistry.getInstance().getAgent("ag-manager");
  // ... interaction loop ...
}
```
