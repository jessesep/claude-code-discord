# Discord Compartment Context
> **Scope**: Discord UI bridge. Handles bot lifecycle, interaction routing, and message formatting.

## ðŸŽ¯ Mission
Provide the system's human interface via Discord. Manages slash commands, interactive buttons, paginated embeds, and real-time status updates for agent tasks.

## ðŸ—ºï¸ Key Filepaths
- `bot.ts`: Discord client initialization and generic interaction/message multiplexing.
- `commands.ts`: Definitions and registration for all slash commands.
- `pagination.ts`: State management and UI for multi-page embeds and long message splitting.
- `formatting.ts`: Markdown utilities for pretty-printing shell/git/code outputs.

## ðŸ› ï¸ Key Dependencies
- `npm:discord.js`: Core library for Discord API interaction.
- `../agent/`: For accessing active session state and dispatching commands to the brain.

## ðŸ“œ Conventions
- **Interaction Wrapper**: Always use `createInteractionContext` to abstract reply/edit/followUp logic.
- **Natural Chat**: Messages in active session channels or @mentions are automatically routed to the `agent` command.
- **UI Components**: Prefer embeds with buttons for structured output (e.g., git status, file lists).

## ðŸ’¡ Code Example: Interaction Context
```typescript
function createInteractionContext(interaction: CommandInteraction | ButtonInteraction): InteractionContext {
  return {
    user: { id: interaction.user.id, username: interaction.user.username },
    deferReply: async () => await interaction.deferReply(),
    reply: async (c) => await (interaction.deferred ? interaction.editReply(v(c)) : interaction.reply(v(c))),
    // Maps standard options to flat getters
    getString: (n, r) => (interaction as any).options?.getString(n, r ?? false)
  };
}
```
